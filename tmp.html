<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>í…ìŠ¤íŠ¸ í˜ì´ì§€ ë³´ê¸°</title>
    <style>
        #nextBtn {
            margin-top: 10px;
            display: none;
        }

        .choiceBtn {
            display: block;
            margin: 5px 0;
            padding: 10px;
            background-color: #eee;
            border: 1px solid #aaa;
            cursor: pointer;
            width: fit-content;
        }
    </style>
</head>

<body>
    <h2>ğŸ“„ íŒŒì¼ ë‚´ìš©</h2>
    <pre id="output">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</pre>
    <button id="nextBtn">ë‹¤ìŒ</button>
    <div id="choices"></div>

    <h2>ğŸš© FLAG í‘œì‹œ</h2>
    <ul id="flags"></ul>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const filePath = params.get('file');
            const flagString = params.get('flag'); // ex: "1010101010"
            const filenow = params.get('now'); // ex: "1010101010"
            /*
            nowëŠ” í”Œë˜ê·¸ ì§„í–‰ë‹¨ê³„
            ex)now 3ëŠ” flag3ë²ˆì§¸ë¥¼ ì°¸ì¡°í•˜ê³ ìˆë‹¤ëŠ”ëœ»
            flag 0~9ëŠ” ì§„í–‰ë‹¨ê³„
            a~zëŠ” ê²°ê³¼ ë‹¨ê³„
            */
            const output = document.getElementById('output');
            const nextBtn = document.getElementById('nextBtn');
            const choicesDiv = document.getElementById('choices');

            // FLAG ë¶„í•´ í›„ ì¶œë ¥
            let pages = []; // $NEXT$ ë¡œ ë¶„í• ëœ í˜ì´ì§€ ì €ì¥
            let currentPage = 0;

            function showPage(index) {
                while (index < pages.length) {
                    let page = pages[index].trim();
                    if (page.startsWith('$CHOICE$')) {
                        output.textContent = 'ì„ íƒì§€ë¥¼ ê³ ë¥´ì„¸ìš”:';
                        nextBtn.style.display = 'none';
                        showChoices(index);
                        return;
                    }

                    if (page === '') {
                        index++;
                        currentPage = index;
                        continue;
                    }

                    output.textContent = page;
                    nextBtn.style.display = 'inline-block';
                    currentPage = index;
                    return;
                }

                nextBtn.style.display = 'none';
            }

            function showPage(index) {
                while (index < pages.length) {
                    const page = pages[index].trim();

                    // $CHOICE$ë§Œ ìˆëŠ” í˜ì´ì§€ëŠ” ê±´ë„ˆëœ€ (ë‹¤ìŒ ë²„íŠ¼ ë¶ˆí•„ìš”)
                    if (page.startsWith('$CHOICE$') || page === '') {
                        index++;
                        currentPage = index;
                        continue;
                    }

                    // ì¼ë°˜ í˜ì´ì§€ ì¶œë ¥
                    output.textContent = page;
                    nextBtn.style.display = 'inline-block';
                    currentPage = index;
                    return;
                }

                // ë” ì´ìƒ ì¶œë ¥í•  í˜ì´ì§€ê°€ ì—†ë‹¤ë©´ ë²„íŠ¼ ìˆ¨ê¹€
                nextBtn.style.display = 'none';
            }

            if (filePath) {
                fetch(filePath)
                    .then(res => {
                        if (!res.ok) throw new Error('íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        return res.text();
                    })
                    .then(text => {
                        pages = text.split('$NEXT$').map(s => s.trim()).filter(s => s.length > 0);
                        showPage(currentPage);
                    })
                    .catch(err => {
                        output.textContent = `ì—ëŸ¬: ${err.message}`;
                    });
            } else {
                output.textContent = 'file íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
            }

            nextBtn.addEventListener('click', () => {
                currentPage++;
                showPage(currentPage);
            });
        });
    </script>
</body>

</html>